<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>MC AryanzUtama</title>

<style>
body{
  margin:0;
  font-family: Arial, sans-serif;
  background: url("https://res.cloudinary.com/dtdodhqqi/image/upload/v1768802294/c6690caf0ff598a60ae714931b491f62_1_mv91ik.jpg");
  background-size: cover;
  color:#000;
}

.container{
  max-width:420px;
  margin:auto;
  height:100vh;
  background:#e5ddd5;
  display:flex;
  flex-direction:column;
}

header{
  background:#075e54;
  color:white;
  padding:10px;
  font-weight:bold;
}

#form{
  padding:15px;
}

input,select,button{
  width:100%;
  padding:10px;
  margin-top:8px;
  border-radius:5px;
  border:1px solid #ccc;
}

button{
  background:#25d366;
  color:white;
  border:none;
  font-weight:bold;
}

#chatBox{
  flex:1;
  padding:10px;
  overflow-y:auto;
}

.bubble{
  max-width:75%;
  padding:8px;
  margin:6px 0;
  border-radius:8px;
  font-size:14px;
}

.me{
  background:#dcf8c6;
  margin-left:auto;
}

.other{
  background:white;
}

.time{
  font-size:10px;
  text-align:right;
  color:#666;
}

.footer{
  display:flex;
  padding:8px;
  background:#f0f0f0;
}

.footer input{
  flex:1;
}
</style>
</head>

<body>
<div class="container">

<header id="header">MC AryanzUtama</header>

<div id="form">
  <input id="name" placeholder="Nama">
  <select id="role">
    <option value="BUYER">BUYER</option>
    <option value="SELLER">SELLER</option>
  </select>
  <input id="nominal" placeholder="Nominal">

  <button onclick="buatRoom()">BUAT ROOM</button>

  <hr>

  <input id="roomCode" placeholder="Room Code">
  <button onclick="masukRoom()">MASUK ROOM</button>
</div>

<div id="room" style="display:none;flex:1;flex-direction:column">
  <div id="chatBox"></div>

  <div class="footer">
    <input id="msg" placeholder="Ketik pesan">
    <button onclick="kirim()">KIRIM</button>
  </div>
</div>

</div>

<script>
const GAS = "https://script.google.com/macros/s/AKfycbx61YG_IOw9Hlk_VJwNiOQmFhbpeFFwRau1EJHttnyJY4KmlKIu6jo23WVZbSCZLfvJ6w/exec";
let token = "";
let roleUser = "";

function buatRoom(){
  fetch(GAS,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      action:"createRoom",
      nominal:nominal.value
    })
  })
  .then(r=>r.json())
  .then(d=>{
    if(!d.roomCode){
      alert("Gagal buat room");
      return;
    }
    roomCode.value = d.roomCode;
    alert("ROOM CODE: "+d.roomCode);
  });
}

function masukRoom(){
  roleUser = role.value;

  fetch(GAS,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      action:"joinRoom",
      roomCode:roomCode.value,
      name:name.value,
      role:role.value
    })
  })
  .then(r=>r.json())
  .then(d=>{
    if(!d.success){
      alert("Room tidak ditemukan");
      return;
    }
    token = d.token;
    document.getElementById("form").style.display="none";
    document.getElementById("room").style.display="flex";
    loadChat();
    setInterval(loadChat,1500);
  });
}

function kirim(){
  if(!msg.value.trim()) return;

  fetch(GAS,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      action:"sendChat",
      token:token,
      from:roleUser,
      text:msg.value
    })
  });

  msg.value="";
}

function loadChat(){
  fetch(GAS,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      action:"getChat",
      token:token
    })
  })
  .then(r=>r.json())
  .then(d=>{
    chatBox.innerHTML="";
    (d.chat||[]).forEach(c=>{
      let div=document.createElement("div");
      div.className="bubble "+(c.from===roleUser?"me":"other");
      div.innerHTML=`<b>${c.from}</b><br>${c.text}<div class="time">${c.time}</div>`;
      chatBox.appendChild(div);
    });
    chatBox.scrollTop=chatBox.scrollHeight;
  });
}
</script>

</body>
</html>
