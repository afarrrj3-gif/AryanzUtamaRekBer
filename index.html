<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>MC AryanzUtama</title>
<style>
body{font-family:sans-serif;background:#0a2a43;color:white}
input,button{padding:10px;margin:5px;width:90%}
#chat{height:300px;overflow:auto;background:#fff;color:#000;padding:10px}
</style>
</head>

<body>

<h2>MC Room</h2>

<div id="form">
<input id="name" placeholder="Nama">
<select id="role">
<option>BUYER</option>
<option>SELLER</option>
</select>
<input id="nominal" placeholder="Nominal">
<button onclick="buatRoom()">BUAT ROOM</button>
<input id="roomCode" placeholder="Room Code">
<button onclick="masukRoom()">MASUK ROOM</button>
</div>

<div id="room" style="display:none">
<div id="chat"></div>
<input id="msg" placeholder="Ketik pesan">
<button onclick="kirim()">KIRIM</button>
</div>

<script>
const GAS = "https://script.google.com/macros/s/AKfycbxdiGr54Z_qXg-Hp11_AyABPqZYJUtAzW9Vt0YoU_7vJXsPKw8YFze-lhQ8Yti8C2ETfA/exec";
let token = "";

function buatRoom(){
fetch(GAS,{method:"POST",body:JSON.stringify({
action:"createRoom",
nominal:nominal.value
})})
.then(r=>r.json())
.then(d=>{
alert("ROOM CODE: "+d.roomCode);
roomCode.value=d.roomCode;
});
}

function masukRoom(){
fetch(GAS,{method:"POST",body:JSON.stringify({
action:"joinRoom",
roomCode:roomCode.value,
name:name.value,
role:role.value
})})
.then(r=>r.json())
.then(d=>{
token=d.token;
form.style.display="none";
room.style.display="block";
loadChat();
setInterval(loadChat,1500);
});
}

function kirim(){
fetch(GAS,{method:"POST",body:JSON.stringify({
action:"sendChat",
token:token,
from:role.value,
text:msg.value
})});
msg.value="";
}

function loadChat(){
fetch(GAS,{method:"POST",body:JSON.stringify({
action:"getChat",
token:token
})})
.then(r=>r.json())
.then(d=>{
chat.innerHTML="";
(d.chat||[]).forEach(c=>{
chat.innerHTML+=`<p><b>${c.from}</b>: ${c.text}<br><small>${c.time}</small></p>`;
});
});
}
</script>

</body>
</html>
