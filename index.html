<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MC AryanzUtama System</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0f172a;
  color: white;
}

header {
  background: #020617;
  padding: 12px;
  text-align: center;
  font-weight: bold;
}

.container {
  padding: 15px;
}

input, select, button {
  width: 100%;
  padding: 10px;
  margin-top: 8px;
  border-radius: 6px;
  border: none;
  font-size: 14px;
}

button {
  background: #22c55e;
  color: black;
  font-weight: bold;
  cursor: pointer;
}

button:disabled {
  background: gray;
}

#chatBox {
  display: none;
}

.chat {
  background: #020617;
  padding: 10px;
  height: 320px;
  overflow-y: auto;
  border-radius: 6px;
  margin-bottom: 10px;
}

.msg {
  margin-bottom: 8px;
}

.me {
  color: #22c55e;
}

.other {
  color: #38bdf8;
}

.system {
  color: #facc15;
  font-style: italic;
}

footer {
  text-align: center;
  font-size: 12px;
  opacity: 0.6;
  margin-top: 20px;
}
</style>
</head>

<body>

<header>MC AryanzUtama System</header>

<div class="container">

<!-- LOGIN -->
<div id="loginBox">
  <input id="name" placeholder="Nama kamu">
  <select id="role">
    <option value="">Pilih Role</option>
    <option value="buyer">Buyer</option>
    <option value="seller">Seller</option>
  </select>
  <input id="roomCode" placeholder="Room Code">
  <button onclick="joinRoom()">MASUK</button>
</div>

<!-- CHAT -->
<div id="chatBox">
  <div class="chat" id="chat"></div>

  <input id="message" placeholder="Ketik pesan...">
  <button onclick="sendMessage()">KIRIM PESAN</button>

  <input type="file" id="file">
  <button onclick="sendImage()">UPLOAD SS PAYMENT</button>

  <button onclick="sendDone()">DONE</button>
</div>

<footer>
Verified by Nexora ID / Powered By AryanzUtama
</footer>

</div>

<script>
const GAS_URL = "https://script.google.com/macros/s/AKfycbx53aPBr4dObFd3ZuBkdqQLHwH_jW-7pn7A6OB_CyRscDpke0lD67UM-xt0ddGaIgU/exec";

let room = "";
let nameUser = "";
let roleUser = "";
let token = "";

function joinRoom() {
  nameUser = document.getElementById("name").value;
  roleUser = document.getElementById("role").value;
  room = document.getElementById("roomCode").value;

  if (!nameUser || !roleUser || !room) {
    alert("Lengkapi data");
    return;
  }

  fetch(GAS_URL, {
    method: "POST",
    body: JSON.stringify({
      action: "joinRoom",
      roomCode: room,
      name: nameUser,
      role: roleUser,
      token: localStorage.getItem("token_" + room)
    })
  })
  .then(r => r.json())
  .then(res => {
    if (!res.success) {
      alert(res.error);
      return;
    }

    token = res.token;
    localStorage.setItem("token_" + room, token);

    document.getElementById("loginBox").style.display = "none";
    document.getElementById("chatBox").style.display = "block";

    addMsg("SYSTEM", "Kamu masuk sebagai " + roleUser, "system");
    loadChat();
    setInterval(loadChat, 2000);
  });
}

function loadChat() {
  fetch(GAS_URL, {
    method: "POST",
    body: JSON.stringify({
      action: "getMessages",
      roomCode: room
    })
  })
  .then(r => r.json())
  .then(res => {
    if (!res.success) return;
    const chat = document.getElementById("chat");
    chat.innerHTML = "";
    res.messages.forEach(m => {
      addMsg(m.name, m.text, m.role === roleUser ? "me" : "other");
    });
    chat.scrollTop = chat.scrollHeight;
  });
}

function sendMessage() {
  const msg = document.getElementById("message").value;
  if (!msg) return;

  fetch(GAS_URL, {
    method: "POST",
    body: JSON.stringify({
      action: "sendMessage",
      roomCode: room,
      name: nameUser,
      role: roleUser,
      token: token,
      text: msg
    })
  });

  document.getElementById("message").value = "";
}

function sendImage() {
  const file = document.getElementById("file").files[0];
  if (!file) return alert("Pilih gambar");

  const reader = new FileReader();
  reader.onload = () => {
    fetch(GAS_URL, {
      method: "POST",
      body: JSON.stringify({
        action: "sendImage",
        roomCode: room,
        name: nameUser,
        role: roleUser,
        token: token,
        image: reader.result
      })
    });
  };
  reader.readAsDataURL(file);
}

function sendDone() {
  const doneText = `
*Format Done bye AryanzUtama*
____________________________
Nomor dana tujuan :
Atas nama :
Dana : ✅
____________________________
Dana :
Gopay :
Qris :
Ovo :
Sea :

*PERHATIAN*
Tf selain Dana dikenakan biaya 1k
`;

  fetch(GAS_URL, {
    method: "POST",
    body: JSON.stringify({
      action: "sendMessage",
      roomCode: room,
      name: "ADMIN",
      role: "admin",
      token: "admin",
      text: doneText
    })
  });
}

function addMsg(name, text, cls) {
  const div = document.createElement("div");
  div.className = "msg " + cls;
  div.innerText = name + " : " + text;
  document.getElementById("chat").appendChild(div);
}
<script>
const GAS_URL = "https://script.google.com/macros/s/AKfycbx53aPBr4dObFd3ZuBkdqQLHwH_jW-7pn7A6OB_CyRscDpke0lD67UM-xt0ddGaIgU/exec"; // URL /exec

function kirimPaymentMasuk() {
  const data = {
    action: "payment_masuk",
    buyer: document.getElementById("buyer").value,
    seller: document.getElementById("seller").value
  };

  fetch(GAS_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  })
  .then(res => res.json())
  .then(res => {
    alert("✅ Payment dikonfirmasi!\nAdmin sudah dapat notif Telegram");
  })
  .catch(err => {
    alert("❌ Gagal kirim ke admin");
    console.error(err);
  });
}
</script>
</body>
</html>
